{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"[ k C n ]  \ud83c\udfe0  homelab","text":"<p>\"The cloud is just someone else's computer\" \u2013 Ancient IT Proverb</p>"},{"location":"#quick-links","title":"\ud83d\udd17 Quick Links","text":"<ul> <li> Service Status</li> <li> Docker Compose</li> <li> My Home Page</li> </ul>"},{"location":"#whats-this-all-about","title":"\ud83d\udc49 What's This All About?","text":"<p>Hello and welcome! This is my personal homelab documentation \u2013 a living knowledge base where I'm trying to document everything from infrastructure setup to those 3 AM debugging sessions that teach you way too much about Docker networking.</p> <p></p>"},{"location":"#why-self-host","title":"\ud83e\udd14 Why Self-Host?","text":"<p>Reasons I run a homelab:</p> <ol> <li>Fun \u2013 Because it's actually so enjoyable</li> <li>Curiosity - It's amazing to see how things work</li> <li>Learning \u2013 Best way to understand infrastructure</li> <li>Privacy \u2013 My data stays on my hardware</li> <li>Control \u2013 I decide when things update (or break)</li> <li>Cost \u2013 Cloud bills add up fast, even faster than electricity ones</li> </ol>"},{"location":"#the-setup","title":"\ud83c\udfd7\ufe0f The Setup","text":""},{"location":"#documentation-sections","title":"\ud83d\udcc2 Documentation Sections","text":"<p>Browse the documentation by topic:</p> <ul> <li> Infrastructure - Hardware setup, network configuration</li> <li> Provisioning - VM and bare-metal deployment workflows</li> <li> Applications - Docker compose, k8s manifests, service configs</li> <li> Automation - Scripts, workflows, infrastructure as code</li> <li> Troubleshooting - Common issues and their solutions</li> <li> Learning - Tutorials, guides, and useful resources</li> </ul> <p></p>"},{"location":"infrastructure/home/","title":"\ud83c\udfe2 Infrastructure","text":""},{"location":"provisioning/0-custom-image/","title":"\ud83d\udcdd Custom Image with Packer","text":""},{"location":"provisioning/0-custom-image/#goal","title":"\ud83c\udfaf Goal","text":"<p>To build a clean <code>debian-custom-cloudimg.tar.gz</code> image for MAAS deployment.</p>"},{"location":"provisioning/0-custom-image/#environment-tools","title":"\ud83d\udee0\ufe0f Environment &amp; Tools","text":"<p>Host Environment:</p> <ul> <li>Windows 11 / WSL2 (Ubuntu)</li> <li>Builder: Packer with QEMU builder</li> </ul> <p>Repository:</p> <p>Clone Canonical's MAAS Image Builder (based on HCL format):</p> <pre><code>git clone https://github.com/canonical/packer-maas.git\ncd packer-maas</code></pre>"},{"location":"provisioning/0-custom-image/#1-packer-configuration-wsl2qemu","title":"1. Packer Configuration (WSL2/QEMU)","text":"<p>The default configuration required modifications primarily due to the Nested Virtualization environment (QEMU running inside WSL2/Hyper-V).</p>"},{"location":"provisioning/0-custom-image/#11-kvm-acceleration-fix-crucial-for-wsl2","title":"1.1. KVM Acceleration Fix (Crucial for WSL2)","text":"<p>The main build may fail because QEMU attempts to use KVM acceleration (<code>accel=kvm</code>), which is inaccessible from within WSL2, resulting in a \"Permission denied\" error.</p> <p>File Modified: <code>debian-cloudimg.pkr.hcl</code></p> <p>Original configuration:</p> <pre><code># Original (doesn't work in WSL2)\nqemu_machine = { \"amd64\" = \"accel=kvm\" }\nqemu_cpu = { \"amd64\" = \"host\" }</code></pre> <p>Fixed configuration for WSL2 emulation:</p> <pre><code>locals {\n    qemu_machine = { \"amd64\" = \"q35\" }   # Use standard machine without KVM flag\n    qemu_cpu = { \"amd64\" = \"max\" }       # Use safe CPU setting\n}</code></pre> <p>Explanation:</p> <ul> <li>Removed hardcoded KVM flags in the <code>locals</code> block</li> <li>Forces pure software emulation (slower but works in WSL2)</li> <li>Uses <code>q35</code> machine type (standard x86_64 chipset)</li> <li>Uses <code>max</code> CPU model (safe fallback without host-passthrough)</li> </ul>"},{"location":"provisioning/0-custom-image/#12-boot-mode-configuration","title":"1.2. Boot Mode Configuration","text":"<p>Switched the boot mode to BIOS (<code>BOOT=bios</code>) to avoid potential conflicts with UEFI/OVMF firmware copying and usage within the QEMU environment.</p>"},{"location":"provisioning/0-custom-image/#13-build-the-image","title":"1.3. Build the Image","text":"<p>Run the build command:</p> <pre><code>make debian SERIES=trixie BOOT=bios</code></pre> <p>Build process:</p> <ol> <li>Packer downloads the Debian Trixie ISO</li> <li>QEMU starts the VM in software emulation mode</li> <li>Automated installation proceeds via preseed</li> <li>Image is packaged as <code>debian-custom-cloudimg.tar.gz</code></li> </ol> <p>Expected output:</p> <pre><code>==&gt; Builds finished. The artifacts of successful builds are:\n--&gt; qemu.debian: debian-custom-cloudimg.tar.gz</code></pre>"},{"location":"provisioning/0-custom-image/#2-maas-deployment-steps","title":"2. MAAS Deployment Steps","text":"<p>After a successful build, the image is ready for deployment.</p>"},{"location":"provisioning/0-custom-image/#21-file-transfer","title":"2.1. File Transfer","text":"<p>Copy the image to the MAAS server:</p> <pre><code>scp debian-custom-cloudimg.tar.gz user@maas_server_ip:/home/user/</code></pre>"},{"location":"provisioning/0-custom-image/#22-upload-image-to-maas","title":"2.2. Upload Image to MAAS","text":"<p>SSH to the MAAS server and upload the custom image:</p> <pre><code>ssh user@maas_server_ip\n\n# Upload the custom image\nmaas admin boot-resources create \\\n    name='custom/debian-trixie' \\\n    title='Debian 13 Trixie Custom' \\\n    architecture='amd64/generic' \\\n    filetype='tgz' \\\n    content@=debian-custom-cloudimg.tar.gz</code></pre>"},{"location":"provisioning/0-custom-image/#23-verify-image-upload","title":"2.3. Verify Image Upload","text":"<p>Check if the image was uploaded successfully:</p> <pre><code>maas admin boot-resources read</code></pre> <p>Look for your custom image in the list:</p> <pre><code>custom/debian-trixie (amd64/generic)</code></pre>"},{"location":"provisioning/0-custom-image/#24-deploy-to-nodes","title":"2.4. Deploy to Nodes","text":"<p>Via MAAS UI:</p> <ol> <li>Navigate to Machines</li> <li>Select a node in Ready state</li> <li>Click Deploy</li> <li>Choose custom/debian-trixie from the OS dropdown</li> <li>Confirm deployment</li> </ol> <p>Via CLI:</p> <pre><code>maas admin machine deploy &lt;system_id&gt; \\\n    distro_series='custom/debian-trixie'</code></pre>"},{"location":"provisioning/0-custom-image/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"provisioning/0-custom-image/#build-fails-with-permission-denied-kvm","title":"Build Fails with \"Permission denied\" (KVM)","text":"<p>Symptom:</p> <pre><code>qemu-system-x86_64: failed to initialize kvm: Permission denied</code></pre> <p>Solution:</p> <p>Apply the KVM fix in section 1.1 - force software emulation by removing <code>accel=kvm</code>.</p>"},{"location":"provisioning/0-custom-image/#build-is-very-slow","title":"Build is Very Slow","text":"<p>Cause:</p> <p>Software emulation (no KVM) is significantly slower than hardware acceleration.</p> <p>Expected time:</p> <ul> <li>With KVM: 5-10 minutes</li> <li>Without KVM (WSL2): 30-60 minutes</li> </ul> <p>Solution:</p> <p>Be patient. Consider building on native Linux with KVM support for faster builds.</p>"},{"location":"provisioning/0-custom-image/#ovmfuefi-boot-issues","title":"OVMF/UEFI Boot Issues","text":"<p>Symptom:</p> <pre><code>Could not find firmware for UEFI boot</code></pre> <p>Solution:</p> <p>Use <code>BOOT=bios</code> flag as shown in section 1.2.</p>"},{"location":"provisioning/0-custom-image/#additional-resources","title":"\ud83d\udcda Additional Resources","text":"<ul> <li>Packer QEMU Builder Docs</li> <li>MAAS Image Builder Repository</li> <li>MAAS Custom Images Documentation</li> </ul>"},{"location":"provisioning/1-cluster-deployment-maas/","title":"\ud83d\udee2\ufe0f MAAS Deployment","text":"<p>Used Prerequisites:</p> <ul> <li>Ubuntu Server: for MAAS Installation</li> <li>Nodes: Three machines (Master, Worker 1, Worker 2) configured for PXE boot</li> </ul>"},{"location":"provisioning/1-cluster-deployment-maas/#maas-deployment-initial-configuration","title":"MAAS Deployment &amp; Initial Configuration","text":""},{"location":"provisioning/1-cluster-deployment-maas/#1-maas-core-installation","title":"1. \ud83d\udcbe MAAS Core Installation","text":"<p>Install the MAAS packages and the required database components.</p> <pre><code># Add repository for latest MaaS version\nsudo apt install software-properties-common\nsudo add-apt-repository ppa:maas/3.7\n\n# Update and install the MaaS package\nsudo apt update\nsudo apt install maas</code></pre>"},{"location":"provisioning/1-cluster-deployment-maas/#2-initial-configuration","title":"2. \u2699\ufe0f Initial Configuration","text":"<p>Initialize the MAAS region controller. You will be prompted to choose a user (create a new one).</p> <pre><code>sudo maas init</code></pre>"},{"location":"provisioning/1-cluster-deployment-maas/#3-access-ui","title":"3. \ud83c\udf10 Access UI","text":"<p>Open a web browser and navigate to:</p> <p><code>http://&lt;MAAS_SERVER_IP&gt;:5240/MAAS</code></p> <p>Login: Use the administrator account credentials set during <code>maas init</code></p>"},{"location":"provisioning/1-cluster-deployment-maas/#maas-networking-domain-configuration","title":"MAAS Networking &amp; Domain Configuration","text":""},{"location":"provisioning/1-cluster-deployment-maas/#1-disable-dhcp-on-the-vlan","title":"1. \ud83d\uded1 Disable DHCP on the VLAN","text":"<p>By default, MAAS provides DHCP. To avoid conflicts with your router, you must disable the dynamic range and only use MAAS for IP reservations.</p> <p>Steps:</p> <ol> <li>Navigate to Subnets in the MAAS UI</li> <li>Select your primary subnet (e.g., <code>192.168.55.0/24</code>)</li> <li>In the DHCP section, delete the dynamic IP range</li> <li>Ensure the DHCP mode for the VLAN is set to \"Unmanaged\" or that the DHCP range is empty</li> </ol>"},{"location":"provisioning/1-cluster-deployment-maas/#2-configure-domain-and-hostnames","title":"2. \ud83d\udcdd Configure Domain and Hostnames","text":"<p>Set a cleaner domain name and ensure MAAS uses consistent naming conventions.</p> <p>Steps:</p> <ol> <li>Navigate to Settings \u2192 General \u2192 Default DNS suffix</li> <li>Change the default (e.g., <code>maas</code>) to something cleaner (e.g., <code>homelab</code>)</li> <li>In the DNS tab, verify that MAAS is configured to manage DNS records for your domain</li> </ol>"},{"location":"provisioning/1-cluster-deployment-maas/#3-ssh-key-registration","title":"3. \ud83d\udd11 SSH Key Registration","text":"<p>You can securely import your keys directly from GitHub, which is faster than pasting them manually.</p> <p>Steps:</p> <ol> <li>Go to User Account \u2192 My Account</li> <li>In the SSH keys section, choose \"Import from GitHub\"</li> <li>Enter your GitHub username - MAAS will automatically fetch and register all your public keys</li> </ol>"},{"location":"provisioning/1-cluster-deployment-maas/#4-commissioning-and-ip-assignment","title":"4. \u2699\ufe0f Commissioning and IP Assignment","text":"<p>Steps:</p> <ol> <li>Start Nodes: Power on your bare-metal nodes configured for PXE boot</li> <li>Commissioning: MAAS will discover them and perform hardware testing. Once complete, they will transition to the Ready state</li> <li>Static IP Reservation: For each Node, go to its configuration page and set a Static IP Reservation corresponding to its MAC address</li> </ol> <p>My configuration:</p> Node Hostname Target IP Control Plane master-00 192.168.55.10 Agent 1 worker-01 192.168.55.11 Agent 2 worker-02 192.168.55.12"},{"location":"provisioning/1-cluster-deployment-maas/#5-deploying-the-nodes","title":"5. \ud83d\ude80 Deploying the Nodes","text":"<ol> <li>Select Ubuntu 24.04 LTS or your custom image for each node</li> <li>Ensure the static IP from the table above is assigned during deployment</li> <li>After deployment, remember to change boot sequence from PXE to External Disk</li> </ol>"},{"location":"provisioning/1-cluster-deployment-maas/#6-post-deployment-cleanup","title":"6. \ud83e\uddf9 Post-Deployment Cleanup","text":"<p>After deployment, the nodes are running Ubuntu 24.04 with the user <code>ubuntu</code> by default and some MAAS settings.</p>"},{"location":"provisioning/1-cluster-deployment-maas/#user-account-migration-ubuntu-admin","title":"User Account Migration (ubuntu \u2192 admin)","text":"<p>Perform SSH login using <code>ssh ubuntu@&lt;IP_ADDRESS&gt;</code> and execute:</p> <pre><code># Add new user\nsudo adduser admin\n\n# Grant sudo rights to the new user\nsudo usermod -aG sudo admin</code></pre> <p>Enable password-less sudo (required for Ansible):</p> <pre><code>sudo visudo</code></pre> <p>Add to the end of the file:</p> <pre><code>admin ALL=(ALL) NOPASSWD: ALL</code></pre> <p>Copy SSH key to new user and fix ownership/permissions:</p> <pre><code>sudo cp -r /home/ubuntu/.ssh /home/admin/\nsudo chown -R admin:admin /home/admin/.ssh\nsudo chmod 700 /home/admin/.ssh\nsudo chmod 600 /home/admin/.ssh/authorized_keys</code></pre>"},{"location":"provisioning/1-cluster-deployment-maas/#switch-to-new-user","title":"Switch to New User","text":"<p>Log out and log back in as the new user:</p> <pre><code>exit\nssh admin@&lt;IP_ADDRESS&gt;</code></pre> <p>If everything works fine, delete the ubuntu user:</p> <pre><code>sudo deluser --remove-home ubuntu</code></pre>"},{"location":"provisioning/1-cluster-deployment-maas/#change-hostname-optional","title":"Change Hostname (Optional)","text":"<pre><code>sudo hostnamectl set-hostname master-00</code></pre>"},{"location":"provisioning/1-cluster-deployment-maas/#remove-maas-apt-proxy-configuration","title":"Remove MAAS APT Proxy Configuration","text":"<pre><code># Remove APT proxy config\nsudo rm -f /etc/apt/apt.conf.d/90curtin-aptproxy\n\n# Remove global proxy environment variables\nsudo sed -i '/maas/d' /etc/environment\nsudo sed -i '/maas/d' /etc/bash.bashrc\n\n# Fix missing packages\nsudo apt update --fix-missing</code></pre> <p>Optionally remove duplicate source warnings:</p> <pre><code>sudo mv /etc/apt/sources.list /etc/apt/sources.list.bak</code></pre>"},{"location":"provisioning/1-cluster-deployment-maas/#final-system-update","title":"Final System Update","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y</code></pre>"},{"location":"provisioning/2-ssh-configuration/","title":"\ud83d\udcc4 SSH Configuration","text":""},{"location":"provisioning/2-ssh-configuration/#generate-ssh-keys","title":"\ud83d\udd10 Generate SSH Keys","text":""},{"location":"provisioning/2-ssh-configuration/#for-windows-powershell","title":"For Windows (PowerShell)","text":"<p>Generate a new SSH key pair:</p> <pre><code># Generate ED25519 key (recommended)\nssh-keygen -t ed25519 -C \"your_email@example.com\"\n\n# Or RSA key (if ED25519 is not supported)\nssh-keygen -t rsa -b 4096 -C \"your_email@example.com\"</code></pre> <p>Default location: <code>C:\\Users\\USER\\.ssh\\id_ed25519</code> (or <code>id_rsa</code>)</p> <p>Steps:</p> <ol> <li>Press Enter to accept the default file location</li> <li>Enter a passphrase (recommended) or leave empty for no passphrase</li> <li>Confirm the passphrase</li> </ol>"},{"location":"provisioning/2-ssh-configuration/#for-linux-wsl","title":"For Linux / WSL","text":"<p>Generate a new SSH key pair:</p> <pre><code># Generate ED25519 key (recommended)\nssh-keygen -t ed25519 -C \"your_email@example.com\"\n\n# Or RSA key (if ED25519 is not supported)\nssh-keygen -t rsa -b 4096 -C \"your_email@example.com\"</code></pre> <p>Default location: <code>~/.ssh/id_ed25519</code> (or <code>id_rsa</code>)</p> <p>Steps:</p> <ol> <li>Press Enter to accept the default file location</li> <li>Enter a passphrase (recommended) or leave empty for no passphrase</li> <li>Confirm the passphrase</li> </ol> <p>Set correct permissions:</p> <pre><code>chmod 700 ~/.ssh\nchmod 600 ~/.ssh/id_ed25519\nchmod 644 ~/.ssh/id_ed25519.pub</code></pre>"},{"location":"provisioning/2-ssh-configuration/#configure-ssh-agent","title":"\ud83d\udd11 Configure SSH Agent","text":""},{"location":"provisioning/2-ssh-configuration/#for-windows-1011","title":"For Windows 10/11","text":"<p>Set up SSH Agent to auto-start and load your key:</p> <pre><code># Set SSH Agent to start automatically\nGet-Service ssh-agent | Set-Service -StartupType Automatic\n\n# Start the SSH Agent service\nStart-Service ssh-agent\n\n# Add your SSH key\nssh-add C:\\Users\\USER\\.ssh\\id_rsa</code></pre>"},{"location":"provisioning/2-ssh-configuration/#for-wsl-or-linux","title":"For WSL or Linux","text":"<p>Note: Windows SSH Agent doesn't work for WSL, so use <code>keychain</code> instead.</p> <p>Install and configure keychain:</p> <pre><code># Install keychain\nsudo apt install keychain</code></pre> <p>Add keychain setup to your shell profile (<code>~/.bashrc</code> or <code>~/.zshrc</code>):</p> <pre><code># Add this line to ~/.bashrc or ~/.zshrc\neval $(keychain --eval --quiet id_rsa)</code></pre> <p>Reload your shell configuration:</p> <pre><code>source ~/.bashrc\n# or\nsource ~/.zshrc</code></pre>"},{"location":"provisioning/2-ssh-configuration/#configure-local-ssh-aliases","title":"\u2699\ufe0f Configure Local SSH Aliases","text":"<p>Works the same for Windows and Linux/WSL.</p> <p>Edit your SSH config file:</p> <ul> <li>Windows: <code>C:\\Users\\USER\\.ssh\\config</code></li> <li>Linux/WSL: <code>~/.ssh/config</code></li> </ul> <p>Add the following configuration:</p> <pre><code># --- HOMELAB NODES ---\nHost master-00\n    HostName 192.168.55.10\n    User admin\n    IdentityFile ~/.ssh/id_rsa\n    ForwardAgent yes\n\nHost worker-01\n    HostName 192.168.55.11\n    User admin\n    IdentityFile ~/.ssh/id_rsa\n    ForwardAgent yes\n\nHost worker-02\n    HostName 192.168.55.12\n    User admin\n    IdentityFile ~/.ssh/id_rsa\n    ForwardAgent yes</code></pre> <p>Make sure the permissions are correct:</p> <pre><code>chmod 600 ~/.ssh/config</code></pre> <p>Usage:</p> <p>Now you can simply SSH using hostnames:</p> <pre><code>ssh master-00\nssh worker-01\nssh worker-02</code></pre>"},{"location":"provisioning/2-ssh-configuration/#configure-hostnames","title":"\ud83d\udcdd Configure Hostnames","text":""},{"location":"provisioning/2-ssh-configuration/#for-windows","title":"For Windows","text":"<p>Open as Administrator: <code>C:\\Windows\\System32\\drivers\\etc\\hosts</code></p> <p>Add the following entries:</p> <pre><code>192.168.55.10    master-00\n192.168.55.11    worker-01\n192.168.55.12    worker-02</code></pre>"},{"location":"provisioning/2-ssh-configuration/#for-linux-or-wsl","title":"For Linux or WSL","text":"<p>Edit <code>/etc/hosts</code>:</p> <pre><code>sudo nano /etc/hosts</code></pre> <p>Add the following entries:</p> <pre><code>192.168.55.10    master-00\n192.168.55.11    worker-01\n192.168.55.12    worker-02</code></pre> <p>Save and exit (<code>Ctrl+X</code>, <code>Y</code>, <code>Enter</code> in nano).</p>"},{"location":"provisioning/2-ssh-configuration/#copy-ssh-key-to-remote-hosts","title":"\ud83d\ude80 Copy SSH Key to Remote Hosts","text":""},{"location":"provisioning/2-ssh-configuration/#using-ssh-copy-id-linuxwsl","title":"Using ssh-copy-id (Linux/WSL)","text":"<pre><code># Copy key to remote host\nssh-copy-id admin@192.168.55.10\nssh-copy-id admin@192.168.55.11\nssh-copy-id admin@192.168.55.12</code></pre>"},{"location":"provisioning/2-ssh-configuration/#manual-method-windowslinux","title":"Manual Method (Windows/Linux)","text":"<p>If <code>ssh-copy-id</code> is not available:</p> <pre><code># Display your public key\ncat ~/.ssh/id_rsa.pub\n\n# SSH to the remote host\nssh admin@192.168.55.10\n\n# On the remote host, add the key\nmkdir -p ~/.ssh\necho \"YOUR_PUBLIC_KEY\" &gt;&gt; ~/.ssh/authorized_keys\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\nexit</code></pre>"},{"location":"provisioning/2-ssh-configuration/#verify-ssh-connection","title":"\u2705 Verify SSH Connection","text":"<p>Test passwordless SSH:</p> <pre><code>ssh master-00\nssh worker-01\nssh worker-02</code></pre> <p>If configured correctly, you should connect without entering a password!</p>"}]}